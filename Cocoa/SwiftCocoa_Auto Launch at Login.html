<!doctype html><html class="theme-next mist" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="Jason,Blog"><link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="This article is based on this blog. I adjust and implement using Swift. The project could be downloaded here.Development environment:OS X: 10.11.4XCode: 7.3Swift: 2.2Enable ‘launch at login’ in Mac Ap"><meta name="keywords"><meta property="og:type" content="article"><meta property="og:title" content="Swift & Cocoa: Auto Launch at Login"><meta property="og:url" content="http://en.atjason.com/Cocoa/SwiftCocoa_Auto Launch at Login.html"><meta property="og:site_name" content="Jason"><meta property="og:description" content="This article is based on this blog. I adjust and implement using Swift. The project could be downloaded here.Development environment:OS X: 10.11.4XCode: 7.3Swift: 2.2Enable ‘launch at login’ in Mac Ap"><meta property="og:image" content="https://farm6.staticflickr.com/5486/31303440372_cb535ac1c7_o.jpg"><meta property="og:image" content="https://farm6.staticflickr.com/5541/31412010806_3e0b0d8720_o.jpg"><meta property="og:image" content="https://farm6.staticflickr.com/5464/31412010896_49ea699cdb_o.jpg"><meta property="og:image" content="https://farm6.staticflickr.com/5608/31332952541_d9fd0d8d04_o.jpg"><meta property="og:image" content="https://farm6.staticflickr.com/5338/31448859785_4939efab2f_o.jpg"><meta property="og:image" content="https://farm6.staticflickr.com/5763/31078319720_0523f09e3b_o.jpg"><meta property="og:updated_time" content="2016-12-06T01:51:54.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Swift & Cocoa: Auto Launch at Login"><meta name="twitter:description" content="This article is based on this blog. I adjust and implement using Swift. The project could be downloaded here.Development environment:OS X: 10.11.4XCode: 7.3Swift: 2.2Enable ‘launch at login’ in Mac Ap"><meta name="twitter:image" content="https://farm6.staticflickr.com/5486/31303440372_cb535ac1c7_o.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!1,motion:!1,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://en.atjason.com/Cocoa/SwiftCocoa_Auto Launch at Login.html"><title>Swift & Cocoa: Auto Launch at Login | Jason</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-26569268-1","auto"),ga("send","pageview")</script><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Jason</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://en.atjason.com/Cocoa/SwiftCocoa_Auto Launch at Login.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Jason"><meta itemprop="description" content=""><meta itemprop="image" content="https://i.imgur.com/lS5NEuU.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jason"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Swift & Cocoa: Auto Launch at Login</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-14T16:50:00+08:00">2016-04-14 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Cocoa/" itemprop="url" rel="index"><span itemprop="name">Cocoa</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>This article is based on this <a href="http://martiancraft.com/blog/2015/01/login-items/" target="_blank" rel="external">blog</a>. I adjust and implement using Swift. The project could be downloaded <a href="https://github.com/atjason/CocoaDemoWithSwift/tree/master/AutoLaunch" target="_blank" rel="external">here</a>.</p><p>Development environment:</p><ul><li>OS X: 10.11.4</li><li>XCode: 7.3</li><li>Swift: 2.2</li></ul><h1 id="Enable-‘launch-at-login’-in-Mac-App-Store"><a href="#Enable-‘launch-at-login’-in-Mac-App-Store" class="headerlink" title="Enable ‘launch at login’ in Mac App Store"></a>Enable ‘launch at login’ in Mac App Store</h1><p>Beside works in sandbox mode, to enable ‘launch at login’ in Mac App Store, should mee this requirement:</p><blockquote><p>2.26 Apps that are set to auto-launch or to have other code automatically run at startup or login without user consent will be rejected.</p></blockquote><p>How to deal with it?<br>Easy, just add a checkbox in Preferences to let user choose auto launch or not. And, make sure, do <strong>NOT</strong> enable it by default. Otherwise Apple will reject it (I was ever rejected for this reason).</p><p><img src="https://farm6.staticflickr.com/5486/31303440372_cb535ac1c7_o.jpg" alt=""></p><a id="more"></a><h1 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h1><p>The precondition is, you already setup your normal project.</p><h2 id="Add-New-Target-of-Helper"><a href="#Add-New-Target-of-Helper" class="headerlink" title="Add New Target of Helper"></a>Add New Target of Helper</h2><p>Add a new target of your project. You can name the target as “XHelper”, and “X” is your main project.<br>Note: to reduce app’s size, choose the Language of ‘Objective-C’. No worry, only a few code is needed.</p><p><img src="https://farm6.staticflickr.com/5541/31412010806_3e0b0d8720_o.jpg" alt=""></p><h2 id="Settings-for-Helper-Target"><a href="#Settings-for-Helper-Target" class="headerlink" title="Settings for Helper Target"></a>Settings for Helper Target</h2><p>Let the helper works in the background and doesn’t display a Dock icon.<br>Open the <strong>Info</strong> tab for the helper target.</p><ul><li>Under the ‘Custom OS X Application Target Properties’ section, add a new row with the Key ‘<strong>Application is background only</strong>’ and the Boolean value of ‘<strong>YES</strong>’.</li></ul><p><img src="https://farm6.staticflickr.com/5464/31412010896_49ea699cdb_o.jpg" alt=""></p><p>Next, let the helper target skips the install when the base application also gets installed. To do this:<br>Open the <strong>Build Settings</strong> tab for the helper target.</p><ul><li>Search for ‘<strong>Skip Install</strong>’, setting this option to ‘<strong>YES</strong>’</li></ul><p><img src="https://farm6.staticflickr.com/5608/31332952541_d9fd0d8d04_o.jpg" alt=""></p><h2 id="Settings-for-Main-Target"><a href="#Settings-for-Main-Target" class="headerlink" title="Settings for Main Target"></a>Settings for Main Target</h2><p>Open the <strong>Build Settings</strong> tab for the main target.</p><ul><li>Search for the item called ‘<strong>Strip Debug Symbols During Copy</strong>’, and set this item to ‘<strong>NO</strong>’.</li></ul><p><img src="https://farm6.staticflickr.com/5338/31448859785_4939efab2f_o.jpg" alt=""></p><p>Open the <strong>Build Phases</strong> tab for the main target</p><ul><li>If you don’t already have a ‘Copy Files’ phase, then add one by selecting the small + sign in the top left corner of this section.</li><li>Expand the ‘Copy Files’ phase, and select ‘<strong>Wrapper</strong>’ from the Destination drop-down menu</li><li>In the Subpath section, type the following path: “<strong>Contents/Library/LoginItems</strong>“</li><li>Select the + button for the Name section, then search for and add the ‘X Helper.app’ application bundle from the source list that appears, and select it in the list. Click ‘Add’ when done.</li></ul><p><img src="https://farm6.staticflickr.com/5763/31078319720_0523f09e3b_o.jpg" alt=""></p><p>This will ensure that the Helper target is copied into our application bundle when we compile the project.</p><h2 id="Code-for-Helper-Target"><a href="#Code-for-Helper-Target" class="headerlink" title="Code for Helper Target"></a>Code for Helper Target</h2><p>First, remove the menu and base window in the Helper app’s XIB file.</p><p>Open <code>AppDelegate.m</code>, add these code in <code>applicationDidFinishLaunching</code>. It will find out the path for the main application, launch it, and then terminate itself.<br></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)applicationDidFinishLaunching:(<span class="built_in">NSNotification</span> *)aNotification &#123;</div><div class="line">  <span class="built_in">NSArray</span> *pathComponents = [[[<span class="built_in">NSBundle</span> mainBundle] bundlePath] pathComponents];</div><div class="line">  pathComponents = [pathComponents subarrayWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [pathComponents count] - <span class="number">4</span>)];</div><div class="line">  <span class="built_in">NSString</span> *path = [<span class="built_in">NSString</span> pathWithComponents:pathComponents];</div><div class="line">  [[<span class="built_in">NSWorkspace</span> sharedWorkspace] launchApplication:path];</div><div class="line">  [<span class="built_in">NSApp</span> terminate:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h2 id="Code-for-Main-Target"><a href="#Code-for-Main-Target" class="headerlink" title="Code for Main Target"></a>Code for Main Target</h2><p>There’re mainly 2 parts.</p><h3 id="Add-Preferences"><a href="#Add-Preferences" class="headerlink" title="Add Preferences"></a>Add Preferences</h3><p>This is mainly to remember user’s choice to auto launch or not. For details, refer to my another <a href="https://github.com/atjason/CocoaDemoWithSwift/tree/master/Preferences" target="_blank" rel="external">project for Preferences</a>.</p><h3 id="Set-Auto-Launch"><a href="#Set-Auto-Launch" class="headerlink" title="Set Auto Launch"></a>Set Auto Launch</h3><p>This step is in fact easy. The core is function of <code>SMLoginItemSetEnabled</code>. Remember to <code>import ServiceManagement</code>.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Cocoa</div><div class="line"><span class="keyword">import</span> ServiceManagement</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindowController</span>: <span class="title">NSWindowController</span> </span>&#123;   </div><div class="line">  <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(sender: NSButton)</span></span> &#123;    </div><div class="line">    <span class="keyword">let</span> appBundleIdentifier = <span class="string">"com.atjason.swift.cocoa.AutoLaunchHelper"</span></div><div class="line">    <span class="keyword">let</span> autoLaunch = (autoLaunchCheckbox.state == <span class="type">NSOnState</span>)</div><div class="line">    <span class="keyword">if</span> <span class="type">SMLoginItemSetEnabled</span>(appBundleIdentifier, autoLaunch) &#123;</div><div class="line">      <span class="keyword">if</span> autoLaunch &#123;</div><div class="line">        <span class="type">NSLog</span>(<span class="string">"Successfully add login item."</span>)</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="type">NSLog</span>(<span class="string">"Successfully remove login item."</span>)</div><div class="line">      &#125;</div><div class="line">      </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="type">NSLog</span>(<span class="string">"Failed to add login item."</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="Test-Auto-Launch"><a href="#Test-Auto-Launch" class="headerlink" title="Test Auto Launch"></a>Test Auto Launch</h1><p>In theory, your app and helper should meet these requirements:</p><ul><li>Move the app in the /Applications folder.</li><li>Both the main and Helper application are signed.</li><li>Both the main and Helper application are sandboxed.</li></ul><p>But in fact, when my test app meet none of the requirements above, it still can auto lauch after reboot. Not sure why, but if you plan to release your app in Mac App Store, obviously these requirements will be met.</p><p>Good luck.</p></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/Cocoa/SwiftCocoa_Localization.html" rel="next" title="Swift & Cocoa: Localization"><i class="fa fa-chevron-left"></i> Swift & Cocoa: Localization</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/Cocoa/Preferences Window.html" rel="prev" title="Preferences Window">Preferences Window <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview">Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://i.imgur.com/lS5NEuU.jpg" alt="Jason"><p class="site-author-name" itemprop="name">Jason</p><p class="site-description motion-element" itemprop="description">Digital Nomad, Mac Developer</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">categories</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/atjason" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="https://twitter.com/hereisjason" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://toolinbox.net/" title="Toolinbox" target="_blank">Toolinbox</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Enable-‘launch-at-login’-in-Mac-App-Store"><span class="nav-number">1.</span> <span class="nav-text">Enable ‘launch at login’ in Mac App Store</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Steps"><span class="nav-number">2.</span> <span class="nav-text">Steps</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Add-New-Target-of-Helper"><span class="nav-number">2.1.</span> <span class="nav-text">Add New Target of Helper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Settings-for-Helper-Target"><span class="nav-number">2.2.</span> <span class="nav-text">Settings for Helper Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Settings-for-Main-Target"><span class="nav-number">2.3.</span> <span class="nav-text">Settings for Main Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-for-Helper-Target"><span class="nav-number">2.4.</span> <span class="nav-text">Code for Helper Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-for-Main-Target"><span class="nav-number">2.5.</span> <span class="nav-text">Code for Main Target</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-Preferences"><span class="nav-number">2.5.1.</span> <span class="nav-text">Add Preferences</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-Auto-Launch"><span class="nav-number">2.5.2.</span> <span class="nav-text">Set Auto Launch</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Test-Auto-Launch"><span class="nav-number">3.</span> <span class="nav-text">Test Auto Launch</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2011 - <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Jason</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">var disqus_config=function(){this.page.url="http://en.atjason.com/Cocoa/SwiftCocoa_Auto Launch at Login.html",this.page.identifier="Cocoa/SwiftCocoa_Auto Launch at Login.html",this.page.title="Swift & Cocoa: Auto Launch at Login"},d=document,s=d.createElement("script");s.src="https://jason-en.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(d.head||d.body).appendChild(s)</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle(),$("#local-search-input").focus()}var isfetched=!1,search_path="search.xml";0===search_path.length&&(search_path="search.xml");var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(t),s=document.getElementById(o);r.addEventListener("input",function(){var e=this.value.trim().toLowerCase().split(/[\s\-]+/),t=[];if(this.value.trim().length>0&&n.forEach(function(o){function n(e,t,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=e.substring(t,o),c=[],l=0;s+a.length<=o&&0!=n.length;){var h=s-t,p=s-t+a.length;for(c.push(i.substring(l,h)),c.push('<b class="search-keyword">'+i.substring(h,p)+"</b>"),n.pop(),l=p;0!=n.length&&(r=n[n.length-1],s=r.position,a=r.word,l>s-t);)n.pop()}return c.push(i.substring(l)),c.join("")}var r=!1,s=0,a=o.title.trim(),i=a.toLowerCase(),c=o.content.trim().replace(/<[^>]+>/g,""),l=c.toLowerCase(),h=decodeURIComponent(o.url),p=[],u=[];if(""!=a&&(e.forEach(function(e,t){function o(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}p=p.concat(o(e,i,!1)),u=u.concat(o(e,l,!1))}),(p.length>0||u.length>0)&&(r=!0,s=p.length+u.length)),r){var f="";p.sort(function(e,t){return t.position-e.position}),u.sort(function(e,t){return t.position-e.position}),0!=p.length?f+="<li><a href='"+h+"' class='search-result-title'>"+n(a,0,a.length,p)+"</a>":f+="<li><a href='"+h+"' class='search-result-title'>"+a+"</a>";var d=parseInt(1),g=!1;-1===d&&(g=!0);for(var v=0;0!=u.length&&(g||v<d);){var $=u[u.length-1],m=$.position,C=$.word,w=m-20,y=m+80;w<0&&(w=0),y<m+C.length&&(y=m+C.length),y>c.length&&(y=c.length),f+="<a href='"+h+'\'><p class="search-result">'+n(c,w,y,u)+"...</p></a>",v++}f+="</li>",t.push({item:f,hitCount:s,id:t.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===t.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{t.sort(function(e,t){return e.hitCount!=t.hitCount?t.hitCount-e.hitCount:e.id-t.id});var o='<ul class="search-result-list">';t.forEach(function(e,t){o+=e.item}),o+="</ul>",s.innerHTML=o}}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()})</script></body></html>